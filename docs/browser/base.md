---
toc: content
order: 1
---

# 浏览器简介

## 打开 1 个页面，有 4 个进程？

最初的浏览器都是单进程的（单进程浏览器是指浏览器的所有功能模块都是运行在同一个进程里），它们不稳定、不流畅且不安全，之后出现了 Chrome，创造性地引入了多进程架构，并解决了这些遗留问题。

打开一个页面至少需要 `4 个进程`：`浏览器主进程`、`网络进程`、`GPU 进程`、`渲染进程`；如果打开的页面有运行插件的话，还需要再加上 1 个`插件进程`。
![多进程浏览器](https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png)

-   浏览器主进程：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
-   渲染进程：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页。
-   GPU 进程：主要负责 3D 绘制。
-   网络进程：主要负责页面的网络资源加载。
-   插件进程：主要是负责插件的运行。

不过凡事都有两面性，虽然多进程模型提升了浏览器的稳定性、流畅性和安全性，但同样不可避免地带来了一些问题：

-   更高的资源占用：因为每个进程都会包含公共基础结构的副本（如 JavaScript 运行环境），这就意味着浏览器会消耗更多的内存资源。
-   更复杂的体系架构：浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了。

<!-- ## TCP 保证了数据完整地传输

TCP：是一种面向连接的、可靠的、基于字节流的`传输层`通信协议。`TCP 保证了数据完整地传输`，它的连接可分为三个阶段：`建立连接`、`传输数据`和`断开连接`。
![一个 TCP 连接的生命周期](https://static001.geekbang.org/resource/image/44/44/440ee50de56edc27c6b3c992b3a25844.png)

-   **首先，建立连接阶段。** 这个阶段是通过“三次握手”来建立客户端和服务器之间的连接。TCP 提供面向连接的通信传输。面向连接是指在数据通信开始之前先做好两端之间的准备工作。`所谓三次握手，是指在建立一个 TCP 连接时，客户端和服务器总共要发送三个数据包以确认连接的建立`。
-   **其次，传输数据阶段。** 在该阶段，接收端需要对每个数据包进行确认操作，也就是接收端在接收到数据包之后，需要发送确认数据包给发送端。所以当发送端发送了一个数据包之后，在规定时间内没有接收到接收端反馈的确认消息，则判断为数据包丢失，并触发发送端的重发机制。同样，`一个大的文件在传输过程中会被拆分成很多小的数据包，这些数据包到达接收端后，接收端会按照 TCP 头中的序号为其排序，从而保证组成完整的数据`。
-   **最后，断开连接阶段。** 数据传输完毕之后，就要终止连接了，涉及到最后一个阶段“四次挥手”来保证双方都能断开连接。

## HTTP 协议是基于 TCP 协议的，你怎么理解 HTTP 和 TCP 的关系？

`TCP` 协议是`传输层协议`，主要解决`数据如何在网络中传输`，而 `HTTP` 是`应用层协议`，主要解决`如何包装数据`。 -->

## 为什么 Javascript 要是单线程的?

JavaScript 设计的初衷是：处理页面中用户的交互，以及操作 DOM 树、CSS 样式树来给用户呈现一份动态而丰富的交互体验和服务器逻辑的交互处理。

假设存在两个线程同时操作一个 DOM，一个负责修改一个负责删除，则可能出现 UI 操作的冲突。

虽然可以通过锁来解决上面的问题。但为了避免因为引入了锁而带来更大的复杂性，Javascript 在最初就选择了单线程执行。

## 为什么 JS 阻塞页面加载?

`由于 JavaScript 是可操纵 DOM 的，如果在修改这些元素属性同时渲染界面，那么渲染线程前后获得的元素数据就可能不一致了。`

因此，为了防止渲染出现不可预期的结果，浏览器设置 `GUI 渲染线程` 与 `JavaScript 引擎`为互斥的关系。

当 `JavaScript 引擎` 执行时 `GUI 渲染线程` 会被挂起，GUI 更新会被保存在一个队列中等到引擎线程空闲时立即被执行。

因此，`如果 JS 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉。`

## CSS 加载会造成阻塞吗?

DOM 和 CSSOM 通常是`并行构建`的，所以 `CSS 加载不会阻塞 DOM 的解析`。

然而，由于 Render Tree 是依赖于 DOM Tree 和 CSSOM Tree 的，

所以，他必须等待到 CSSOM Tree 构建完成，也就是 CSS 资源加载完成后，才能开始渲染。

因此，`CSS 加载会阻塞 Dom 的渲染`。
